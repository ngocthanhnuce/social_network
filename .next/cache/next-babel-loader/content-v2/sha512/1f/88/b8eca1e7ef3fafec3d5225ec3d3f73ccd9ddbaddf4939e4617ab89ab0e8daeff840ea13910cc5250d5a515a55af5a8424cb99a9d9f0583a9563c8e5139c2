{"ast":null,"code":"import _regeneratorRuntime from \"C:/Users/Admin/Documents/social/social_network/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"C:/Users/Admin/Documents/social/social_network/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _extends from \"C:/Users/Admin/Documents/social/social_network/node_modules/@babel/runtime/helpers/esm/extends\";\nvar _jsxFileName = \"C:\\\\Users\\\\Admin\\\\Documents\\\\social\\\\social_network\\\\pages\\\\_app.js\";\nimport React from \"react\";\nvar __jsx = React.createElement;\nimport axios from \"axios\";\nimport { parseCookies, destroyCookie } from \"nookies\";\nimport baseUrl from \"../utils/baseUrl\";\nimport { redirectUser } from \"../utils/authUser\";\nimport Layout from \"../components/Layout/Layout\";\nimport \"react-toastify/dist/ReactToastify.css\";\nimport \"semantic-ui-css/semantic.min.css\";\nimport \"cropperjs/dist/cropper.css\";\n\nfunction MyApp(_ref) {\n  var Component = _ref.Component,\n      pageProps = _ref.pageProps;\n  return __jsx(Layout, _extends({}, pageProps, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 12,\n      columnNumber: 5\n    }\n  }), __jsx(Component, _extends({}, pageProps, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 13,\n      columnNumber: 7\n    }\n  })));\n}\n\n_c = MyApp;\n\nMyApp.getInitialProps = /*#__PURE__*/function () {\n  var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(_ref2) {\n    var Component, ctx, _parseCookies, token, pageProps, protectedRoutes, res, _res$data, user, userFollowStats;\n\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            Component = _ref2.Component, ctx = _ref2.ctx;\n            _parseCookies = parseCookies(ctx), token = _parseCookies.token;\n            pageProps = {};\n            protectedRoutes = ctx.pathname === \"/\" || ctx.pathname === \"/[username]\" || ctx.pathname === \"/notifications\" || ctx.pathname === \"/post/[postId]\" || ctx.pathname === \"/messages\" || ctx.pathname === \"/search\";\n\n            if (token) {\n              _context.next = 9;\n              break;\n            }\n\n            destroyCookie(ctx, \"token\");\n            protectedRoutes && redirectUser(ctx, \"/login\");\n            _context.next = 27;\n            break;\n\n          case 9:\n            if (!Component.getInitialProps) {\n              _context.next = 13;\n              break;\n            }\n\n            _context.next = 12;\n            return Component.getInitialProps(ctx);\n\n          case 12:\n            pageProps = _context.sent;\n\n          case 13:\n            _context.prev = 13;\n            _context.next = 16;\n            return axios.get(\"\".concat(baseUrl, \"/api/auth\"), {\n              headers: {\n                Authorization: token\n              }\n            });\n\n          case 16:\n            res = _context.sent;\n            _res$data = res.data, user = _res$data.user, userFollowStats = _res$data.userFollowStats;\n            if (user) !protectedRoutes && redirectUser(ctx, \"/\");\n            pageProps.user = user;\n            pageProps.userFollowStats = userFollowStats;\n            _context.next = 27;\n            break;\n\n          case 23:\n            _context.prev = 23;\n            _context.t0 = _context[\"catch\"](13);\n            destroyCookie(ctx, \"token\");\n            redirectUser(ctx, \"/login\");\n\n          case 27:\n            return _context.abrupt(\"return\", {\n              pageProps: pageProps\n            });\n\n          case 28:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee, null, [[13, 23]]);\n  }));\n\n  return function (_x) {\n    return _ref3.apply(this, arguments);\n  };\n}();\n\nexport default MyApp;\n\nvar _c;\n\n$RefreshReg$(_c, \"MyApp\");","map":{"version":3,"sources":["C:/Users/Admin/Documents/social/social_network/pages/_app.js"],"names":["axios","parseCookies","destroyCookie","baseUrl","redirectUser","Layout","MyApp","Component","pageProps","getInitialProps","ctx","token","protectedRoutes","pathname","get","headers","Authorization","res","data","user","userFollowStats"],"mappings":";;;;;;AAAA,OAAOA,KAAP,MAAkB,OAAlB;AACA,SAASC,YAAT,EAAuBC,aAAvB,QAA4C,SAA5C;AACA,OAAOC,OAAP,MAAoB,kBAApB;AACA,SAASC,YAAT,QAA6B,mBAA7B;AACA,OAAOC,MAAP,MAAmB,6BAAnB;AACA,OAAO,uCAAP;AACA,OAAO,kCAAP;AACA,OAAO,4BAAP;;AAEA,SAASC,KAAT,OAAyC;AAAA,MAAxBC,SAAwB,QAAxBA,SAAwB;AAAA,MAAbC,SAAa,QAAbA,SAAa;AACvC,SACE,MAAC,MAAD,eAAYA,SAAZ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,MACE,MAAC,SAAD,eAAeA,SAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KADF,CADF;AAKD;;KANQF,K;;AAQTA,KAAK,CAACG,eAAN;AAAA,uEAAwB;AAAA;;AAAA;AAAA;AAAA;AAAA;AAASF,YAAAA,SAAT,SAASA,SAAT,EAAoBG,GAApB,SAAoBA,GAApB;AAAA,4BACJT,YAAY,CAACS,GAAD,CADR,EACdC,KADc,iBACdA,KADc;AAElBH,YAAAA,SAFkB,GAEN,EAFM;AAIhBI,YAAAA,eAJgB,GAKpBF,GAAG,CAACG,QAAJ,KAAiB,GAAjB,IACAH,GAAG,CAACG,QAAJ,KAAiB,aADjB,IAEAH,GAAG,CAACG,QAAJ,KAAiB,gBAFjB,IAGAH,GAAG,CAACG,QAAJ,KAAiB,gBAHjB,IAIAH,GAAG,CAACG,QAAJ,KAAiB,WAJjB,IAKAH,GAAG,CAACG,QAAJ,KAAiB,SAVG;;AAAA,gBAYjBF,KAZiB;AAAA;AAAA;AAAA;;AAapBT,YAAAA,aAAa,CAACQ,GAAD,EAAM,OAAN,CAAb;AACAE,YAAAA,eAAe,IAAIR,YAAY,CAACM,GAAD,EAAM,QAAN,CAA/B;AAdoB;AAAA;;AAAA;AAAA,iBAkBhBH,SAAS,CAACE,eAlBM;AAAA;AAAA;AAAA;;AAAA;AAAA,mBAmBAF,SAAS,CAACE,eAAV,CAA0BC,GAA1B,CAnBA;;AAAA;AAmBlBF,YAAAA,SAnBkB;;AAAA;AAAA;AAAA;AAAA,mBAuBAR,KAAK,CAACc,GAAN,WAAaX,OAAb,gBAAiC;AACjDY,cAAAA,OAAO,EAAE;AAAEC,gBAAAA,aAAa,EAAEL;AAAjB;AADwC,aAAjC,CAvBA;;AAAA;AAuBZM,YAAAA,GAvBY;AAAA,wBA2BgBA,GAAG,CAACC,IA3BpB,EA2BVC,IA3BU,aA2BVA,IA3BU,EA2BJC,eA3BI,aA2BJA,eA3BI;AA6BlB,gBAAID,IAAJ,EAAU,CAACP,eAAD,IAAoBR,YAAY,CAACM,GAAD,EAAM,GAAN,CAAhC;AAEVF,YAAAA,SAAS,CAACW,IAAV,GAAiBA,IAAjB;AACAX,YAAAA,SAAS,CAACY,eAAV,GAA4BA,eAA5B;AAhCkB;AAAA;;AAAA;AAAA;AAAA;AAkClBlB,YAAAA,aAAa,CAACQ,GAAD,EAAM,OAAN,CAAb;AACAN,YAAAA,YAAY,CAACM,GAAD,EAAM,QAAN,CAAZ;;AAnCkB;AAAA,6CAuCf;AAAEF,cAAAA,SAAS,EAATA;AAAF,aAvCe;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAAxB;;AAAA;AAAA;AAAA;AAAA;;AA0CA,eAAeF,KAAf","sourcesContent":["import axios from \"axios\";\nimport { parseCookies, destroyCookie } from \"nookies\";\nimport baseUrl from \"../utils/baseUrl\";\nimport { redirectUser } from \"../utils/authUser\";\nimport Layout from \"../components/Layout/Layout\";\nimport \"react-toastify/dist/ReactToastify.css\";\nimport \"semantic-ui-css/semantic.min.css\";\nimport \"cropperjs/dist/cropper.css\";\n\nfunction MyApp({ Component, pageProps }) {\n  return (\n    <Layout {...pageProps}>\n      <Component {...pageProps} />\n    </Layout>\n  );\n}\n\nMyApp.getInitialProps = async ({ Component, ctx }) => {\n  const { token } = parseCookies(ctx);\n  let pageProps = {};\n\n  const protectedRoutes =\n    ctx.pathname === \"/\" ||\n    ctx.pathname === \"/[username]\" ||\n    ctx.pathname === \"/notifications\" ||\n    ctx.pathname === \"/post/[postId]\" ||\n    ctx.pathname === \"/messages\" ||\n    ctx.pathname === \"/search\";\n\n  if (!token) {\n    destroyCookie(ctx, \"token\");\n    protectedRoutes && redirectUser(ctx, \"/login\");\n  }\n  //\n  else {\n    if (Component.getInitialProps) {\n      pageProps = await Component.getInitialProps(ctx);\n    }\n\n    try {\n      const res = await axios.get(`${baseUrl}/api/auth`, {\n        headers: { Authorization: token }\n      });\n\n      const { user, userFollowStats } = res.data;\n\n      if (user) !protectedRoutes && redirectUser(ctx, \"/\");\n\n      pageProps.user = user;\n      pageProps.userFollowStats = userFollowStats;\n    } catch (error) {\n      destroyCookie(ctx, \"token\");\n      redirectUser(ctx, \"/login\");\n    }\n  }\n\n  return { pageProps };\n};\n\nexport default MyApp;\n"]},"metadata":{},"sourceType":"module"}